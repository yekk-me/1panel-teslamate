# Mytesla

Mytesla æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç‰¹æ–¯æ‹‰è½¦è¾†æ•°æ®è‡ªæ‰˜ç®¡è®°å½•å™¨ï¼Œé›†æˆäº† TeslaMateã€Grafana æ•°æ®å¯è§†åŒ–å’Œ TeslaMateAPIï¼Œæ”¯æŒé€šè¿‡ Cloudflare Tunnel è¿›è¡Œå®‰å…¨çš„å†…ç½‘ç©¿é€è®¿é—®ã€‚

## åŠŸèƒ½ç‰¹æ€§

* ğŸ“Š **æ•°æ®è®°å½•**: è‡ªåŠ¨è®°å½•é©¾é©¶ã€å……ç”µã€è½¯ä»¶æ›´æ–°ç­‰æ•°æ®
* ğŸ“ˆ **æ•°æ®å¯è§†åŒ–**: å†…ç½® Grafana ä»ªè¡¨æ¿ï¼Œæä¾›ä¸°å¯Œçš„æ•°æ®å›¾è¡¨
* ğŸ”’ **éšç§ä¿æŠ¤**: æ•°æ®å®Œå…¨å­˜å‚¨åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Š
* ğŸš— **å¤šè½¦è¾†æ”¯æŒ**: æ”¯æŒåŒæ—¶è®°å½•å¤šè¾†ç‰¹æ–¯æ‹‰è½¦è¾†
* ğŸ“± **Web ç•Œé¢**: æä¾›å‹å¥½çš„ Web ç®¡ç†ç•Œé¢
* ğŸŒ **API æ¥å£**: æä¾› TeslaMateAPI RESTful æ¥å£
* ğŸ” **å®‰å…¨è®¿é—®**: é›†æˆ Cloudflare Tunnel å†…ç½‘ç©¿é€ï¼Œæ”¯æŒ Basic Auth è®¤è¯

## å®‰è£…è¦æ±‚

### å†…ç½®ç»„ä»¶

* TeslaMate (ç‰¹æ–¯æ‹‰æ•°æ®æ”¶é›†å™¨)
* PostgreSQL æ•°æ®åº“ï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
* MQTT æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
* Grafana æ•°æ®å¯è§†åŒ–ï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
* TeslaMateAPI RESTful æ¥å£ï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
* Cloudflare Tunnelï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰
* Traefik åå‘ä»£ç†ï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²ï¼‰

### ç«¯å£è¯´æ˜

* **Traefik HTTP**: é»˜è®¤ç«¯å£ 80ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰ HTTP æœåŠ¡

## é¦–æ¬¡é…ç½®

### 1. å‡†å¤‡ Cloudflare Tunnel é…ç½®

åœ¨å®‰è£…åº”ç”¨ä¹‹å‰ï¼Œæ‚¨éœ€è¦å‡†å¤‡ Cloudflare Tunnel ç›¸å…³é…ç½®ï¼š

1. **åˆ›å»º Cloudflare è´¦å·**
   - è®¿é—® [Cloudflare å®˜ç½‘](https://cloudflare.com/) æ³¨å†Œè´¦å·
   - æ·»åŠ æ‚¨çš„åŸŸååˆ° Cloudflare

2. **åˆ›å»º Cloudflare Tunnel**
   - ç™»å½• [Cloudflare Zero Trust Dashboard](https://one.dash.cloudflare.com/)
   - è¿›å…¥ ç½‘ç»œ â†’ éš§é“
   - ç‚¹å‡» "åˆ›å»ºéš§é“" åˆ›å»ºæ–°çš„éš§é“
   - è®°å½•ç”Ÿæˆçš„ Tunnel Token

3. **é…ç½®å…¬å…±ä¸»æœºå**
   - è¿›å…¥ åˆ›å»ºçš„éš§é“ â†’ å…¬å…±ä¸»æœºå â†’ æ·»åŠ 
   - æ·»åŠ æ‚¨é…ç½®çš„åŸŸå (ä¾‹å¦‚: `mytesla.example.com` )ï¼Œè‡ªåŸŸå¡«å†™ mytesla åŸŸé€‰æ‹©ä½ è‡ªå·±çš„åŸŸå
   - æœåŠ¡é€‰æ‹© httpï¼ŒURL å¡«å†™ http://traefik:80
   - ç‚¹å‡» "ä¿å­˜" ä¿å­˜é…ç½®

### 2. å®‰è£…åº”ç”¨

åœ¨ 1Panel åº”ç”¨å•†åº—ä¸­æ‰¾åˆ° Myteslaï¼Œç‚¹å‡»å®‰è£…å¹¶å¡«å†™ä»¥ä¸‹å¿…è¦é…ç½®ï¼š

#### Cloudflare é…ç½®

* **Cloudflare Tunnel Token**: ä»æ­¥éª¤1è·å–çš„éš§é“ä»¤ç‰Œ
* **Domain**: æ‚¨é…ç½®çš„åŸŸå (ä¾‹å¦‚: `mytesla.example.com`)

#### Basic Auth é…ç½®

* **Basic Auth Username**: è®¿é—® TeslaMate çš„ç”¨æˆ·å
* **Basic Auth Password**: è®¿é—® TeslaMate çš„å¯†ç 

#### API å®‰å…¨é…ç½®

* **API Token**: ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œç”¨äº TeslaMateAPI å®‰å…¨è®¤è¯

#### å…¶ä»–é…ç½®

* æ•°æ®åº“é…ç½®ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†ç 
* Grafana ç®¡ç†å‘˜è´¦å·ï¼šè®¾ç½® Grafana çš„ç™»å½•å¯†ç 

### 3. é…ç½® TeslaMate

å®‰è£…å®Œæˆåï¼š

1. **é€šè¿‡åŸŸåè®¿é—®**: è®¿é—® `https://æ‚¨çš„åŸŸå` è¿›å…¥ TeslaMate ç®¡ç†ç•Œé¢
2. è¾“å…¥ Basic Auth ç”¨æˆ·åå’Œå¯†ç 
3. æŒ‰ç…§ç•Œé¢æç¤ºè¿›è¡Œç‰¹æ–¯æ‹‰è´¦å·æˆæƒ
4. æ·»åŠ æ‚¨çš„ç‰¹æ–¯æ‹‰è½¦è¾†

### 4. è®¿é—® Grafana ä»ªè¡¨æ¿

1. **é€šè¿‡åŸŸåè®¿é—®**: è®¿é—® `https://æ‚¨çš„åŸŸå/grafana`
2. ä½¿ç”¨å®‰è£…æ—¶è®¾ç½®çš„ç®¡ç†å‘˜è´¦å·ç™»å½•
3. æµè§ˆé¢„é…ç½®çš„ä»ªè¡¨æ¿æŸ¥çœ‹è½¦è¾†æ•°æ®

## è®¿é—®åœ°å€æ€»è§ˆ

å®‰è£…å®Œæˆåï¼Œè¯·è®°å½•ä»¥ä¸‹è®¿é—®åœ°å€ï¼Œè¿™äº›ä¿¡æ¯åœ¨é…ç½® Mytesla.cc æ—¶ä¼šç”¨åˆ°ï¼š

### ğŸŒ é€šè¿‡åŸŸåè®¿é—® (æ¨è)

* **TeslaMate ä¸»ç•Œé¢**: `https://æ‚¨çš„åŸŸå` (éœ€è¦ Basic Auth)
* **Grafana ä»ªè¡¨æ¿**: `https://æ‚¨çš„åŸŸå/grafana`
* **API æ¥å£**: `https://æ‚¨çš„åŸŸå/api`
* **API æµ‹è¯•**: `https://æ‚¨çš„åŸŸå/api/ping`

### ğŸ  æœ¬åœ°ç½‘ç»œè®¿é—®

* **æ‰€æœ‰æœåŠ¡**: `http://æœåŠ¡å™¨IP:80` (é€šè¿‡ Traefik ç»Ÿä¸€è®¿é—®)

## åœ¨ Mytesla.cc ä¸­é…ç½®

å®Œæˆéƒ¨ç½²åï¼Œæ‚¨å¯ä»¥åœ¨ [Mytesla.cc](https://mytesla.cc) ä¸­é…ç½®è¿œç¨‹è®¿é—®ï¼š

1. è®¿é—® [https://mytesla.cc](https://mytesla.cc)
2. è¿›å…¥ Settings â†’ TeslaMate é…ç½®
3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **API åœ°å€**: `https://æ‚¨çš„åŸŸå`

   - **API Token**: å®‰è£…æ—¶ç”Ÿæˆçš„ API Token (åœ¨åº”ç”¨è¯¦æƒ…ä¸­å¯æŸ¥çœ‹)
4. ç‚¹å‡»æµ‹è¯•è¿æ¥éªŒè¯é…ç½®
5. é…ç½®æˆåŠŸåå³å¯åœ¨ Mytesla.cc ä¸­æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„ç‰¹æ–¯æ‹‰æ•°æ®

## æ•°æ®å®‰å…¨

* âœ… æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨æ‚¨çš„æœ¬åœ°æœåŠ¡å™¨ä¸Š
* âœ… æ”¯æŒæ•°æ®åŠ å¯†å­˜å‚¨
* âœ… API æ¥å£ä½¿ç”¨ Token è¿›è¡Œå®‰å…¨è®¤è¯
* âœ… TeslaMate æ”¯æŒ Basic Auth è®¤è¯ä¿æŠ¤
* âœ… Cloudflare Tunnel æä¾›å®‰å…¨çš„å†…ç½‘ç©¿é€
* âœ… å»ºè®®å®šæœŸå¤‡ä»½ PostgreSQL æ•°æ®åº“

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•é€šè¿‡åŸŸåè®¿é—®æœåŠ¡**
   - æ£€æŸ¥ Cloudflare Tunnel æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š `docker logs mytesla-cloudflared`

   - ç¡®è®¤åŸŸå DNS è§£ææ­£ç¡®
   - éªŒè¯ Tunnel Token é…ç½®æ­£ç¡®

2. **Basic Auth è®¤è¯å¤±è´¥**
   - æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ .htpasswd æ–‡ä»¶ç”ŸæˆæˆåŠŸ
   - æŸ¥çœ‹ Traefik æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

3. **æ— æ³•è¿æ¥ç‰¹æ–¯æ‹‰è´¦å·**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤ç‰¹æ–¯æ‹‰è´¦å·å’Œå¯†ç æ­£ç¡®
   - æŸ¥çœ‹ TeslaMate æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

4. **Grafana æ— æ³•æ˜¾ç¤ºæ•°æ®**
   - ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸
   - æ£€æŸ¥ TeslaMate æ˜¯å¦æˆåŠŸæ”¶é›†åˆ°æ•°æ®
   - éªŒè¯ Grafana æ•°æ®æºé…ç½®

5. **API æ¥å£æ— æ³•è®¿é—®**
   - æ£€æŸ¥ TeslaMateAPI æœåŠ¡çŠ¶æ€
   - éªŒè¯ API Token é…ç½®æ­£ç¡®
   - æµ‹è¯• API è¿é€šæ€§ï¼šè®¿é—® `/api/ping` ç«¯ç‚¹

6. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹å®¹å™¨æ—¥å¿—æ’æŸ¥å…·ä½“é—®é¢˜

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker logs mytesla                    # TeslaMate
docker logs mytesla-grafana           # Grafana
docker logs mytesla-teslamateapi      # TeslaMateAPI
docker logs mytesla-cloudflared       # Cloudflare Tunnel
docker logs mytesla-traefik           # Traefik
```

## æ›´å¤šä¿¡æ¯

* [TeslaMate å®˜æ–¹æ–‡æ¡£](https://docs.teslamate.org/)
* [Grafana å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/)
* [Cloudflare Tunnel æ–‡æ¡£](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)
* [Mytesla.cc å®˜ç½‘](https://mytesla.cc/)

## æ³¨æ„äº‹é¡¹

* é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´åˆå§‹åŒ–æ•°æ®åº“å’Œå»ºç«‹ Cloudflare Tunnel è¿æ¥
* å»ºè®®åœ¨ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸‹è¿è¡Œ
* å¦¥å–„ä¿ç®¡ API Token å’Œ Cloudflare Tunnel Token
